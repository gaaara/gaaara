rutorrent_dir=/var/www/rutorrent
echo "Installez pour l'utilisateur:"
read user
egrep "^$user" /etc/passwd >/dev/null || echo "L'utilisateur n'existe pas!"

echo "Entrer un port pour autodl-irssi"
    read -p  "entrer le port: " port
    echo "Entrer le mot de passe de autodl-irssi "
    read -p  "Mot de passe: " pw

# gestionnaire de paquet
if [ "`dpkg --status aptitude | grep Status:`" == "Status: install ok installed" ]
then
        packetg="aptitude"
else
        packetg="apt-get"
fi

$packetg update
$packetg safe-upgrade -y
$packetg install -y install libarchive-zip-perl libnet-ssleay-perl libhtml-parser-perl libxml-libxml-perl libdigest-sha-perl  libjson-perl libjson-xs-perl libxml-libxslt-perl
## svn autodl-irssi
svn export https://svn.code.sf.net/p/autodl-irssi/code/trunk/src ~/.irssi/scripts
## Creation de dossier
mkdir -p ~/.irssi ~/.irssi/scripts ~/.irssi/scripts/autorun
su $user -c 'mkdir -p ~/.autodl'
## on change de r√©pertoire
cd /.irssi/scripts
## on copie autodl-irssi.pl
cp autodl-irssi.pl autorun/

su $USER -c 'touch ~/.autodl/autodl.cfg'

##svn rutorrent plugins
svn co https://svn.code.sf.net/p/autodl-irssi/code/trunk/rutorrent/autodl-irssi

if [ -d "$rutorrent_dir/conf/users/$user/plugins" ]
then
	mkdir $rutorrent_dir/conf/users/$user/plugins/autodl-irssi
else
	mkdir $rutorrent_dir/conf/users/$user/plugins
	mkdir $rutorrent_dir/conf/users/$user/plugins/autodl-irssi
fi
##on donne les permission
chown -R www-data:www-data autodl-irssi

##fichier configuration user conf.php
cat <<'EOF' > $rutorrent_dir/conf/users/$user/plugins/autodl-irssi/conf.php
<?php

$autodlPort = @port@;
$autodlPassword = "@pw@";

?>
EOF
sed -i.bak "s/@port@/$port/g;" $rutorrent_dir/conf/users/$user/plugins/autodl-irssi/conf.php
sed -i.bak "s/@pw@/$pw/g;" $rutorrent_dir/conf/users/$user/plugins/autodl-irssi/conf.php

## Fichier configuration autodl.cfg
cat <<'EOF' > /home/$user/.autodl/autodl.cfg
options]
gui-server-port = @port@
gui-server-password = @pw@
EOF
sed -i.bak "s/@port@/$port/g;" /home/$user/.autodl/autodl.cfg
sed -i.bak "s/@pw@/$pw/g;" /home/$user/.autodl/autodl.cfg

